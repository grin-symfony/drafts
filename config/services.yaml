# This file is the entry point to configure your own services.
# Files in the packages/ subdirectory configure your dependencies.

# Put parameters here that don't need to change on each machine where the app is deployed
# https://symfony.com/doc/current/best_practices.html#use-parameters-for-application-configuration
parameters:

    app.app: "@@" #@
    #app.sign: '='
    #app.app: '%env(key_val:explode:app.sign:default::key:query:url:APP_APP)%'

    ###> REGEXP ###
    app.regexp.digit:   '[0-9]'
    ###< REGEXP ###
    
    ###> SESSION ###
    app.session.max_idle_sec:   '10'
    ###< SESSION ###
    
    ###> Fixture ###
    app.fixture.users:      15
    app.fixture.product.toy:   5
    app.fixture.product.food:   5
    app.fixture.product.furniture:   5
    ###< Fixture ###

    ###> GS\Service ###
    ###< GS\Service ###

    ###> GS\WebApp ###
    ###< GS\WebApp ###

services:
    # default configuration for services in *this* file
    _defaults:
        autowire: true      # Automatically injects dependencies in your services.
        autoconfigure: true # Automatically registers your services as commands, event subscribers, etc.
    
        bind:
            ###> SERVICES ###
            $t:                 '@Symfony\Contracts\Translation\TranslatorInterface'
            $ru12Carbon:        '@app.ru_12_carbon'
            $enUtcCarbon:       '@app.en_utc_carbon'
            ###< SERVICES ###
            
            ###> gs_service ###
            $faker:             '@gs_service.faker'
            ###< gs_service ###
            
            ###> PARAMS ###
            $adminEmail:        '%env(APP_ADMIN_EMAIL)%'
            $kernelProjectDir:  '%kernel.project_dir%'
            ###< PARAMS ###
            
            ###> MESSENGER ###
            $adminSendEmailMessage: '@app.messenger.notifier.admin_send_email'
            $get: '@gs_web_app.messenger.query'
            ###< MESSENGER ###
            
    # makes classes in src/ available to be used as services
    # this creates a service per class whose id is the fully-qualified class name
    App\:
        resource: '../src/'
        exclude:
            - '../src/DependencyInjection/'
            - '../src/Entity/'
            - '../src/Kernel.php'
            - '../src/Service/StringService.php'
    
    # like _instanceof only by path
    app.messenger.command_message_handlers:
        namespace: App\Messenger\Command\Handler\
        resource: '../src/Messenger/Command/Handler/'
        tags:
        -   name: 'messenger.message_handler'
            bus: 'command.bus'
            
    app.messenger.event_message_handlers:
        namespace: App\Messenger\Event\Handler\
        resource: '../src/Messenger/Event/Handler/'
        tags:
        -   name: 'messenger.message_handler'
            bus: 'event.bus'
            
    # add more service definitions when explicit configuration is needed
    # please note that last definitions always *replace* previous ones


    ###> ROUTER ###
    App\Service\Router\AttributeRouterReader:
        class: App\Service\Router\AttributeRouterReader
        tags:
        -   routing.loader
    ###< ROUTER ###
    
    
    _instanceof:
        
        ###> MESSENGER ###
        App\Contract\Messenger\CommandBusHandlerInterface:
            tags:
            -   name:   'messenger.message_handler'
                bus:    'command.bus'

        App\Contract\Messenger\EventBusHandlerInterface:
            tags:
            -   name:   'messenger.message_handler'
                bus:    'event.bus'
        ###< MESSENGER ###
        
        
            
    ###> VALUE RESOLVER ###
    ###< VALUE RESOLVER ###
    
    ###> SERVICES ###
    app.ru_12_carbon:
        parent: gs_service.carbon_factory_immutable
        arguments:
            $settings:
                locale: ru
                timezone: '+1200'
    
    app.en_utc_carbon:
        parent: gs_service.carbon_factory_immutable
        arguments:
            $settings:
                locale: en_US
                timezone: '+0000'
    
    app.messenger.notifier.admin_send_email:
        class: App\Messenger\Notifier\ToAdminSendEmail
        shared: false
        arguments:
            $toEmail: '%env(APP_ADMIN_EMAIL)%'
    
    app.messenger.middleware.add_handler_argument_from:
        abstract: true
        class: App\Messenger\Middleware\AddHandlerArgumentFrom
        
    app.string1:
        class: App\Service\StringService
        arguments:
            $v: 1
            #$v: !abstract 'когда-то в compiller pass его планируется провести'
        
    app.string2:
        class: App\Service\StringService
        arguments:
            $v: 2
            #$v: !abstract 'когда-то в compiller pass его планируется провести'
        
    # ALIAS
    App\Service\StringService: '@app.string1'
    
    #app.interface_adapter:
    #    class: App\Contract\SomeInterface
    #    from_callable: [!service {class: 'App\Service\StringService'}, 'getPath']

    ###< SERVICES ###
    
    
    ###> TAGS ###
    App\DataFixtures\UserFixtures:
        class: App\DataFixtures\UserFixtures
        tags:
        -   name: doctrine.fixture.orm
            group: user
    ###< TAGS ###
    
    
    ###< DOCTRINE ###
    
    App\Service\Doctrine\PurgerTruncateFactory:
        class:  App\Service\Doctrine\PurgerTruncateFactory
        tags:
        -   name:   'doctrine.fixtures.purger_factory'
            alias:  't'
    
    ###> DOCTRINE ###